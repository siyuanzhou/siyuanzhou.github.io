---
layout: post
title: "分布式系统复习汇总"
date: 2019-10-28 10:36
toc: true
comments: true
categories: 技术学习
tags: 
	- 复习
	- 分布式
---

#### 第一章-概述

“一个分布式系统是一些独立的计算机的集合，但是对这个系统的用户来说，系统就像一台计算机一样.” 

从硬件角度：每台计算机都是自主的。

从软件角度：对用户来说就像与单个系统打交道。

<!--more-->

##### 计算系统的表现形式

•分布式系统都建立于大量自治的计算机节点之上。这些节点通过SAN (System Area Network)、LAN或WAN以层次方式互连

•分布式系统被认为高可扩展，并能在物理上或逻辑上达到Web规模互连

•分布式系统被划分为四组：集群、P2P网络、计算网格、大数据中心之上的云计算

•**集中式计算：**这种计算范式是将所有计算资源集中在一个物理系统之内。所有资源（处理器、内存、存储器）是全部共享的，并且紧耦合在一个集成式的操作系统中

•**并行计算：**在并行计算中，所有处理器或是紧耦合于中心共享内存或是松耦合于分布式内存

•**分布式计算：**一个分布式系统由众多自治的计算机组成，各自拥有其私有内存，通过计算机网络通信。分布式系统中的信息交换通过消息传递的方式完成

##### 并行和分布式计算系统分类

![image-20200113205823594](https://cdn.jsdelivr.net/gh/siyuanzhou/pic@master/pic/2019-10-28-%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9F%A5%E8%AF%86%E5%A4%8D%E4%B9%A0/image-20200113205823594.png)

![image-20200113205710609](https://cdn.jsdelivr.net/gh/siyuanzhou/pic@master/pic/2019-10-28-%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9F%A5%E8%AF%86%E5%A4%8D%E4%B9%A0/image-20200113205710609.png)

##### 三种云服务模型

•**基础设施即服务（****IaaS****）**：这个模型将用户需要的基础设施（即服务器、存储、网络和数据中心构造）组合在一起。用户可以在使用客户机操作系统的多个虚拟机上配置和运行指定应用

•**平台即服务（****PaaS****）**：这个模型使用户能够在一个虚拟的云平台上配置用户定制的应用。PaaS包括中间件、数据库、开发工具和一些运行时支持（如Web 2.0和Java）

•**软件即服务（****SaaS****）：**这是指面向数千付费云用户的初始浏览器的应用软件。SaaS模型应用于业务流程、工业应用、客户关系管理、企业资源计划、人力资源和合作应用

##### **分布式系统设计目标**

**资源可访问**

响应时间过长，服务不稳定，时常宕机、网络阻塞等，没有用户界面，泄露个人隐私，在法律上的不可行

**透明性**

•**访问**：隐藏数据表示形式的不同以及资源的访问方式的不同，例如提供sdk

•**位置***：隐藏资源的实际位置，如文件下载，不会开放文件的真实物理地址

•**迁移**：隐藏资源的访问过程中，资源是否迁移到了其他地方，如主备切换需要对资源访问者透明

•**复制**：隐藏资源是否进行复制，例如DNS缓存是否存在对于访问者是透明的

•**并发**：隐藏资源是否由若干相互竞争的用户共享

•**故障**：隐藏资源的故障和恢复

**开放性**

•**定义完整且中立的接口**

–完整意味着接口实现不可缺少的全部规定

–不完整意味着开发者需要添加特定一些细节

–中立意味着接口定义不涉及如何实现的内容

•**互操作性**

–定义：来自不同厂商的系统和组件可以在何种程度上共存和相互配合

–标签框架案例：一份数据，一次MR实现各个合作厂商的标签功能，框架定义接口，合作商提供实现

•**策略与机制分离**

–机制是组件之间的结构关系和运行方式

–策略是“机制”具体实现某些特定场景的一些可定制化的配置组合

–假分离：逻辑上分离，但实现上可能仍然是一个整体

–真分离：例如浏览器插件，针对缓存机制自定义一些策略

##### 可扩展性

•**可扩展内容**

–规模可扩展：更多的用户和资源加入系统

–地域可扩展：多地容灾

–管理可扩展：跨多个独立机构仍然可管理

•**扩展技术**

–隐藏通信等待时间：异步通信，ajax

–分布技术：把组件拆分成多个部分然后分布到系统中去。DNS服务器

–**复制和缓存**

•优点：增加可用性，有助于负载均衡

•缺点：数据有时效性，因此有一致性问题

#### 关键技术

#####    1.通信

进程间的通信是一切分布式系统的基础，它基于底层网络提供的底层消息传递机制。

**分层通信协议**

•中间件协议是中间件提供的用于支持高层应用系统通信的协议

![image-20200113211157150](https://cdn.jsdelivr.net/gh/siyuanzhou/pic@master/pic/2019-10-28-%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9F%A5%E8%AF%86%E5%A4%8D%E4%B9%A0/image-20200113211157150.png)

•不同的中间件系统有不同的中间件协议

–支持远程过程调用的协议，如DCE

–支持远程对象调用的协议，如CORBA

–支持实时流数据传输并保持同步的协议

–可靠多播协议，用于支持可靠多播服务的中间件系统



•从通信持久性方面

–持久通信：传输的消息一直由通信中间件存储，直到该消息被传送给接收方，如电子邮件系统

–瞬时通信：通信中间件只在发送和接收应用程序正在运行的时候才存储消息，即由于传输中断或者接收方当前不在活动状态，中间件就不传输消息，而是丢弃消息



•从通信同步性方面

–同步通信：发送方提交消息后将被阻塞，直到知道其消息被接收。发送方可有三类同步点

```
1基于发送：发送方中间件请求传输完成
2基于接收：请求被传送到目标接收方
3基于响应：接收方返回响应
```

–异步通信：发送方在提交要传输的消息后立刻接着后续的执行，不会阻塞



**远程过程调用**

•像调用本地子程序一样，调用远程子程序，调用者和被调者都不用考虑通信问题

![image-20200113211302474](https://cdn.jsdelivr.net/gh/siyuanzhou/pic@master/pic/2019-10-28-%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9F%A5%E8%AF%86%E5%A4%8D%E4%B9%A0/image-20200113211302474.png)

**远程方法调用**

•像调用本地对象的方法一样，调用远程对象的方法，调用者和被调者都不用考虑通信问题

![image-20200113211329364](https://cdn.jsdelivr.net/gh/siyuanzhou/pic@master/pic/2019-10-28-%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9F%A5%E8%AF%86%E5%A4%8D%E4%B9%A0/image-20200113211329364.png)

**面向消息的通信**

p远程过程调用和远程方法调用都有助于隐藏分布式系统中的通信。但这两种机制并不总是适用的：如当无法保证发送请求时接收端正在执行的情况下,如同步性会阻塞发送进程.需要其他通信机制的支持:如面向消息的通信



**面向消息的瞬时通信-MPI**

提供高层通信，支持并行计算，如MPP、COW

可靠的底层网络

支持分组通信，地址（groupID, processID）

支持多种通信方式

```
–瞬时异步 MPI_bsend
–基于收条的瞬时同步 MPI_send
–基于递交的瞬时同步 MPI_ssend
–基于响应的瞬时同步 MPI_sendrecv
```



**面向消息的持久通信**

•其支持系统一般称为消息队列系统或者面向消息的中间件

–支持持久异步通信

–适合于对传输时间要求宽松的场合，如几分钟

–不保证消息到达接收方的时间，也不保证接收方一定读取消息

松散耦合的通信方式，使用方便



**多播通信**

•组：由系统或用户确定的若干个进程的集合

–组的成员籍（membership）

•通信方式

–点到点通信（point-to-point）：单播（unicast）

–一到多通信(one-to-many) ：多播（multicast）、广播（broadcast）

![image-20200113211515335](https://cdn.jsdelivr.net/gh/siyuanzhou/pic@master/pic/2019-10-28-%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9F%A5%E8%AF%86%E5%A4%8D%E4%B9%A0/image-20200113211515335.png)

##### 2.同步

单机系统容易给发生的所有事件定义一个全局顺序，但是**分布式系统没有全局时钟**，很难给所有事件定义一个全局顺序。

**Lamport****逻辑时钟**：判断两个事件发生先后的标准

![image-20200113212040206](https://cdn.jsdelivr.net/gh/siyuanzhou/pic@master/pic/2019-10-28-%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9F%A5%E8%AF%86%E5%A4%8D%E4%B9%A0/image-20200113212040206.png)

Vector Clock的无限增长问题：（1）采用服务器向量：不要用client来标识向量空间，用server来标识向量空间。(2)向量时钟的剪枝：向量剪枝尽量只丢掉一些向量时钟的信息，而不是丢掉实实在在的数据。

分布式系统在进行同步时一般总是需要一个主节点来做协调工作，需要系统集体做出决定.



**paxos**

为了避免单点故障，会有一个Acceptor集合，Proposer想Acceptor集合发送提案，Acceptor集合中的每个成员都有可能同意该提案且每个Acceptor只能批准一个提案，只有当一半以上的成员同意了一个提案，就认为该提案被选定了。

Paxos的目标：保证最终有一个value会被选定，当value被选定后，进程最终也能获取到被选定的value。

![image-20200113212404313](https://cdn.jsdelivr.net/gh/siyuanzhou/pic@master/pic/2019-10-28-%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9F%A5%E8%AF%86%E5%A4%8D%E4%B9%A0/image-20200113212404313.png)

##### 3.一致性

•分布式系统中对数据进行复制一般是为了提高可靠性或性能，难题是副本之间的一致性问题



–数据为中心的一致性模型

进程在读一条数据时，**期待返回的是最近一次写操作的结果**，在没有全局性逻辑时钟的情况下，很难知道哪一次写操作是最近一次。

**顺序一致性**：任何执行结果都是相同的，就好像所有进程对数据存储的读、写操作是按某种序列顺序执行的，并且每个进程的操作按照程序所制定的顺序出现在这个序列中。

**因果一致性**：一种弱化的顺序一致性模型。所有进程必须以相同的顺序看到具有潜在因果关系的写操作。不同机器上的进程可以以不同的顺序看到并发的写操作

**最终一致性**：系统中数据的副本可以容忍在很长时间内一定程度的不一致，但是在不对数据进行修改的前提下，最终会达到一致



–用户为中心的一致性模型

**单调读**：在某一时间读取了数据项的值为V1，进程之后的读操作总是V1，或者是在V1的基础上的更新的值

**单调写**：进程完成对数据的写动作，后续的写动作，必须在之前提交的写动作之后完成

##### 4.容错

**容错重要概念**

•可用性（availability）

–如果系统可以正确的操作运行，就说系统是可用的

–高可用是说系统在任何给定的时间都是可响应的

•可靠性（reliability）

–系统可以无故障的持续运行（7 X 24小时）

•安全性（safety）

–系统偶然出现故障的情况能正常操作而不会出现任何灾难

•可维护性（maintainability）

–发生故障的系统被恢复的难易程度

•分区容忍性（partition tolerance）

–把宕掉的机器和正常的机器进行分区，机器正常运行的分区仍然能够满足一致性和可用性



**CAP定理**

•Consistency(一致性)、 Availability(可用性)、Partition tolerance(分区容忍性) 三选二

–C(一致性)：一致性是系统的承诺（例如成功完成了某个操作），希望尽量信守承诺

–A (可用性)：用户访问服务，要有响应，而且希望越快越好

–P(分区容忍)：不可避免，但是在出现分区时，希望尽量兼顾A和C



**故障恢复**

•容错的基本要求就是系统能够在故障中恢复，目前来看比较有效的就是回退方式

•checkpoint

–系统需要定时找到一个全局的一致性切面，形成一个快照保存下来，这个快照也称为恢复线路

–仅仅基于checkpoint的回退是有损的恢复方式

•基于消息日志

–如果消息的传输可以重放，那么就可以在某个checkpoint的基础上，重放之后的消息，达到一个全局一致性

##### 5.安全性

**安全威胁应对手段**

•加密**：**数据结构转换为一些攻击者无法理解的形式

•身份认证和授权**：**一般是基于用户名密码的认证方式，会涉及ip白名单，数字签名、数字证书、秘钥、授权和确权等

•审计：攻击者通常不希望留下痕迹，追踪各个客户的访问内容和访问方式，虽然不能提供任何具体的安全威胁有关的防护，但是在发生了安全破坏之后对分析入侵和破坏行为非常有意义。因此对攻击者有震慑作用

•访问控制列表（ACL）：每个用户表示一行，每个被访问的对象表示一列

•保护域/用户组/角色 ：缩小ACL的方法是利用保护域，保护域是一组用户，可以将保护域作为一个用户加入ACL

##### 6.分布式共享内存

**分布式共享内存DSM**

•分布式共享内存DSM (Distributed Shared Memory):它使得不同机器上的进程不用通过共享物理内存就可以使用共享数据。DSM是一个共享内存的程序模型，它在某些方面要优于基于消息的模型

•进程访问DSM中的数据就如同访问本机的内存一样。DSM运行系统还应保证在不同机器上执行的进程可以观察到别人对DSM的修改，DSM中存在复制数据，为了提高访问速度，每台机器都存有最近访问的共享数据的备份。



**DSM应用的关键问题**

•当系统容纳相应多的设备时，怎样保持系统的高性能

•访问DSM将导致大量通信开销的产生

•访问DSM的进程相当多时，怎样保证系统的一致性



**消息传递与DSM的比较**

•程序模型：不需要编码、解码；数据的安全；数据的表示；进程的同步方法；异步的通信方式

•效率



**DSM的主要处理方式**

•基于硬件的方式

–依靠硬件来装载、存储指令以完成DSM的寻址操作及远程内存结点的通信（适合于多处理机系统）

•基于虚拟页的方式

–这种方式与传统的虚拟存储器系统类似，不同之处在于：操作系统不是从磁盘中而是通过网络从另一个处理机中获取页

•基于库的方式

–一些程序设计语言或语言的扩展，支持DSM方式。进程通过库调用来完成对DSM中数据的访问

##### 7.分布式文件系统

•从用户的使用角度来看，分布式文件系统是一个标准的文件系统，提供了一系列API，由此进行文件或目录的创建、移动、删除，以及对文件的读写等操作

•从内部实现角度来看，分布式文件系统还要通过网络管理存储在其他节点上的文件和目录。并且，同一文件不只是存储在一个节点上，而是在一簇节点上按规则分布式存储，协同提供服务

目标：高效、可靠、可扩展

关键技术：•高速缓存机制•容错机制•一致性•负载均衡

**•HDFS的主要设计目标**

**存储非常大的文件：**这里非常大指的是几百MB、GB、或者TB级别。实际应用中已有很多集群存储的数据达到PB级别。根据Hadoop官网，Yahoo的Hadoop集群约有10万颗CPU，运行在4万个机器节点上

**采用流式的数据访问方式****:** HDFS基于这样的一个假设：最有效的数据处理模式是一次写入、多次读取，数据集经常从数据源生成或者拷贝一次，然后在其上做很多分析工作。分析工作经常读取其中的大部分数据，即使不是全部。 因此读取整个数据集所需时间比读取第一条记录的延时更重要

**运行于商业硬件上****:** Hadoop不需要特别贵的、可靠的机器，可运行于普通商用机器。商用机器不代表低端机器，在集群中（尤其是大的集群），节点失败率是比较高的，HDFS的目标是确保集群在节点失败的时候不会让用户感觉到明显的中断

##### 8.分布式数据管理

•在大数据时代背景下，海量数据的存储和管理成为了亟待解决的问题

•面临的挑战：–存储规模大；–种类和来源多样化，存储管理复杂；–对数据服务的种类和水平要求高

•关键技术：–分布式文件系统；–分布式数据库

•分布式数据库的基本概念：数据存储在物理上是分布的，逻辑上是统一的，可以看做是一组数据库的集合

•分布式数据库管理系统(DBMS)：分布式数据库系统中的一组软件，负责管理分布环境下逻辑集成数据的存取、一致性、有效性和完备性

**分布式数据库的特性**

•数据的物理分布性•数据的逻辑整体性•数据的分布独立性•场地自治性•场地之间的协调性•数据冗余及冗余透明性•事务管理的分布性

##### 9.流数据与流处理

•流数据是一组由无限快速、持续到达的数据组成的序列，流处理是一种对数据流进行分析处理的并行编程范式

•流处理的基本需求：–高吞吐–高时效–可扩展-高可用

•将流应用建模为有向无环图（DAG）模型

–点：执行一种简单应用逻辑的操作

–有向边：操作之间的逻辑关联，流数据元组(tuple)的传递方向 [元组：最小可被独立处理的单元流数据]

•流处理的并行技术：流水线并行；任务并行；数据并行

**代表性开源流处理系统**

•以元组为单元的单纯流处理系统

–Apache Storm

–Apache Flink

•基于微批处理模型的流处理系统

–Spark Streaming

##### 10.虚拟化

•虚拟化是一种方法，本质上讲是指从逻辑角度而不是物理角度来对资源进行配置，是从单一的逻辑角度来看待不同的物理资源的方法。譬如说，当前只有一台计算机，通过虚拟技术，在用户看来，似乎却是多台，每台都有其各自的CPU、内存、硬盘等物理资源。在一台计算机上同时运行多个逻辑计算机，每个逻辑计算机可运行不同的操作系统，并且应用程序都可以在相互独立的空间内运行而互不影响，从而显著提高计算机的工作效率

• 对于用户，虚拟化技术实现了软件跟硬件分离，用户不需要考虑后台的具体硬件实现，而只需在虚拟层环境上运行自己的系统和软件

• 虚拟化使用软件的方法重新定义划分IT资源，可以实现IT资源的动态分配、灵活调度、跨域共享，提高IT资源利用率，使IT资源能够真正成为社会基础设施，服务于各行各业中灵活多变的应用需求

**虚拟化技术类型**大致看来主要有以下几种类型：拆分、整合、迁移

•拆分：某台计算机性能较高，而工作负荷小，资源没有得到充分利用。这种情况适用于拆分虚拟技术，可以将这台计算机拆分为逻辑上的多台计算机，同时供多个用户使用。这样可以使此服务器的硬件资源得到充分的利用

•整合：当前有大量性能一般的计算机，但在气象预报、地质分析等领域，数据计算往往需要性能极高的计算机，此时可应用虚拟整合技术，将大量性能一般的计算机整合为一台计算机，以满足用户对整体性能的要求

•迁移：将一台逻辑服务器中的闲置的一部分资源动态的加入到另一台逻辑服务器中，提高另一方的性能，实现资源共享、跨系统平台应用等